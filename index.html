<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drag & Drop Scheduler</title>
  <style>
    /* --- BRAND COLORS FROM LOGO --- */
    :root {
      --primary-color: #60A030;    /* main green */
      --accent-color: #70B030;     /* slightly lighter */
      --bg-dark:      #101010;     /* deep backdrop */
      --text-dark:    #333333;     /* body text */
      --text-light:   #ffffff;     /* for buttons, headings on dark */
    }

    /* --- BASE STYLING --- */
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      color: var(--text-dark);
      margin: 0;
      padding: 0;
    }

    /* logo banner */
    .logo {
      background: var(--bg-dark);
      text-align: center;
      padding: 20px;
    }
    .logo img {
      max-width: 300px;
      height: auto;
    }

    /* unified button style */
    button {
      background: var(--primary-color);
      color: var(--text-light);
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: var(--accent-color);
    }

    .employee-dropdown {
      display: none;
      position: fixed;
      top: 100px;
      left: 100px;
      z-index: 9999;
      background: #fff;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-height: 80vh;
      overflow-y: auto;
      padding: 10px;
      width: 300px;
      cursor: move;
    }

    /* layout columns */
    .main-columns {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
      padding: 20px;
      justify-content: center;
    }
    .column {
      flex: 1;
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 300px;
    }

    /* headings in green */
    .column h2,
    .bottom-box h3 {
      text-align: center;
      font-size: 24px;
      color: var(--primary-color);
      margin: 0 0 10px;
    }

    .site-box {
      border: 1px solid var(--accent-color);
      border-radius: 6px;
      padding: 10px;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .site-box h3 {
      margin: 0;
      font-size: 18px;
      color: var(--accent-color);
      text-align: center;
    }

    /* drop‑zones */
    .site-employees {
      min-height: 60px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      border: 1px dashed var(--primary-color);
      padding: 5px;
      border-radius: 4px;
      background: #fff;
    }
    .bottom-row {
      /* override for horizontal wrap */
      flex-wrap: wrap;
    }

    .employee {
      padding: 8px;
      background: var(--accent-color);
      color: var(--text-light);
      margin: 3px 0;
      border-radius: 4px;
      cursor: grab;
    }

    .drag-over {
      background-color: rgba(96,160,48,0.2);
      border-color: var(--primary-color);
    }

    .bottom-section {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 40px 0;
    }
    .bottom-box {
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 10px;
      width: 45%;
      background: #fff;
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="CS_logo_long.jpg" alt="Cornfield Scaffolding Logo" />
  </div>

  <div class="employee-toggle" style="text-align:center; margin:20px 0;">
    <button onclick="toggleEmployees()">Toggle Employee List</button>
  </div>

  <div class="employee-dropdown" id="employeeDropdown">
    <div class="site-box" data-type="unassigned">
      <h3>Employees</h3>
      <div class="site-employees" id="employeeList"></div>
    </div>
  </div>

  <div class="main-columns">
    <div class="column">
      <h2>SITES</h2>
      <div class="site-box">
        <h3>Ketts Meadow</h3>
        <div class="site-employees" data-name="Ketts Meadow"></div>
      </div>
      <div class="site-box">
        <h3>Dovecote Gardens</h3>
        <div class="site-employees" data-name="Dovecote Gardens"></div>
      </div>
      <div class="site-box">
        <h3>Elmwell</h3>
        <div class="site-employees" data-name="Elmwell"></div>
      </div>
      <div class="site-box">
        <h3>Cygnet Rise</h3>
        <div class="site-employees" data-name="Cygnet Rise"></div>
      </div>
      <!-- NEW SITE ADDED -->
      <div class="site-box">
        <h3>Cantley Sugar Factory</h3>
        <div class="site-employees" data-name="Cantley Sugar Factory"></div>
      </div>
    </div>

    <div class="column">
      <h2>GANGS</h2>
      <div class="site-box">
        <h3>Gang 1</h3>
        <div class="site-employees" data-name="Gang 1"></div>
      </div>
      <div class="site-box">
        <h3>Gang 2</h3>
        <div class="site-employees" data-name="Gang 2"></div>
      </div>
      <div class="site-box">
        <h3>Gang 3</h3>
        <div class="site-employees" data-name="Gang 3"></div>
      </div>
    </div>

    <div class="column">
      <h2>&nbsp;</h2>
      <div class="site-box">
        <h3>Gang 4</h3>
        <div class="site-employees" data-name="Gang 4"></div>
      </div>
      <div class="site-box">
        <h3>Gang 5</h3>
        <div class="site-employees" data-name="Gang 5"></div>
      </div>
    </div>
  </div>

  <div class="bottom-section">
    <div class="bottom-box">
      <h3>Holiday</h3>
      <div class="bottom-row site-employees" data-name="Holiday"></div>
    </div>
    <div class="bottom-box">
      <h3>Sick</h3>
      <div class="bottom-row site-employees" data-name="Sick"></div>
    </div>
  </div>

  <!-- Updated Screenshot Button -->
  <div style="text-align:center; margin-top: 20px;">
    <button id="downloadBtn">Screenshot page</button>
  </div>

  <!-- Load html2canvas then wire‑up our click handler -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // Employee data and drag/drop logic
    const employees = [
      "Matthew O’donoughoe","Ashley Coleman","Shane Clarke","Luke Watts",
      "Tyler Didwell","Robert Bone","Tyler Pluck","Tom Piper",
      "Luke Hughes","Benny Ainge","Reece Hendry","Daniel Fisher",
      "Elliot Auld","Ashley Dunthorne","Louis Maynard","Bradley Whymark",
      "Liam Bolt","Riley Bolt","Steve White","Spencer Lane",
      "Ashton Mason","James Smith"
    ];
    let dragged = null;

    function initEmployees() {
      const container = document.getElementById('employeeList');
      container.innerHTML = '';
      employees.forEach(name => {
        const emp = document.createElement('div');
        emp.className = 'employee';
        emp.textContent = name;
        emp.setAttribute('draggable', true);
        container.appendChild(emp);
      });
    }

    function toggleEmployees() {
      const dd = document.getElementById('employeeDropdown');
      dd.style.display = dd.style.display === 'block' ? 'none' : 'block';
      if (dd.style.display === 'block') initEmployees();
    }

    function makeEmployeeBoxDraggable() {
      const box = document.getElementById('employeeDropdown');
      let isDown = false, offset = [0,0];
      box.addEventListener('mousedown', e => {
        if (e.target.closest('.employee')) return;
        isDown = true;
        offset = [box.offsetLeft - e.clientX, box.offsetTop - e.clientY];
        box.style.cursor = 'grabbing';
      });
      document.addEventListener('mouseup', () => {
        isDown = false;
        box.style.cursor = 'move';
      });
      document.addEventListener('mousemove', e => {
        if (!isDown) return;
        box.style.left = (e.clientX + offset[0]) + 'px';
        box.style.top  = (e.clientY + offset[1]) + 'px';
      });
    }

    function enableDragAndDrop() {
      document.addEventListener('dragstart', e => {
        if (e.target.classList.contains('employee')) dragged = e.target;
      });
      document.addEventListener('dragover', e => e.preventDefault());
      document.addEventListener('drop', e => {
        e.preventDefault();
        if (!dragged) return;
        const target = e.target.closest('.site-employees');
        if (target) {
          target.appendChild(dragged);
          saveState();
        }
        dragged = null;
      });
    }

    // Persist layout in localStorage
    function saveState() {
      const positions = {};
      document.querySelectorAll('.site-employees').forEach(zone => {
        const name = zone.dataset.name;
        const list = Array.from(zone.querySelectorAll('.employee'))
                          .map(e => e.textContent);
        if (list.length) positions[name] = list;
      });
      localStorage.setItem('employeePositions', JSON.stringify(positions));
    }

    function loadState() {
      const saved = localStorage.getItem('employeePositions');
      if (!saved) return;
      const positions = JSON.parse(saved);
      initEmployees();
      Object.entries(positions).forEach(([zone, names]) => {
        const el = document.querySelector(`.site-employees[data-name="${zone}"]`);
        names.forEach(n => {
          const emp = Array.from(document.querySelectorAll('.employee'))
                           .find(e => e.textContent === n);
          if (emp) el.appendChild(emp);
        });
      });
    }

    // Wire‑up screenshot button
    document.getElementById('downloadBtn').addEventListener('click', () => {
      html2canvas(document.body).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = 'schedule_screenshot.png';
        link.click();
      });
    });

    // Initialize on load
    window.addEventListener('load', () => {
      makeEmployeeBoxDraggable();
      enableDragAndDrop();
      loadState();
    });
  </script>
</body>
</html>
